<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">
<body>

<metal:block fill-slot="css_slot">
  <LINK href="xpointtaskstyle.css" type="text/css" rel="stylesheet"
        tal:attributes="href string:xpprogressbar.css"/>
</metal:block>

<metal:main fill-slot="main">
  <tal:main-macro metal:define-macro="main">
    
    <div metal:use-macro="here/document_actions/macros/document_actions">
        Document actions (print, sendto etc)
    </div>

    <h1 tal:content="object_title" class="documentFirstHeading">
      Title or id
    </h1>
    
    <div metal:use-macro="here/document_byline/macros/byline">
      Get the byline - contains details about author and modification date.
    </div>

    <table class="listing" width="100%"><tbody>
      <tr>
        <th width="120">Owner(s)</th>
        <th>Estimated hours / Progress Status</th>
      </tr>
      <tr>
        <td>
          <strong>
          <tal:block repeat="owner here/getTask_owners">
            <span tal:define="theOwner python: mtool.getMemberInfo(owner)"
                  tal:content="python: theOwner['fullname']" /><br/>
          </tal:block>
          </strong>
        </td>
        <td>
          <div align="center"><strong>
            <span tal:content="here/getTask_estimated_hours" /> hours / 
            <span tal:content="python: str(here.getTask_progress_percent()) + '%'" />
          </strong></div>
          <div id="XPointProgressBar">
            <div class="fill" align="center"
                 tal:attributes="style python: 'width: ' + str(here.getTask_progress_percent()) + '%'">
            </div>
          </div>
        </td>
      </tr>
    </tbody></table>

    <div>
      <span tal:content="structure here/getTask_text" />
    </div>

    <div tal:define="notesList python: here.getTaskMemosIssuesProposals();"
         tal:condition="notesList">

      <h2>Memos, Issues, Proposals</h2>

      <table class="listing" width="100%"><tbody>
        <tr>
          <th>Title</th>
          <th>Creator</th>
          <th>Status</th>
        </tr>

        <!-- memos -->
        <tal:block tal:repeat="obj python: notesList">
          <tr tal:define="oddrow repeat/obj/odd;
                          url obj/getURL|obj/absolute_url;
                          obj_type obj/portal_type;
                          obj_typeinfo python:here.portal_types.getTypeInfo(obj_type);
                          icon python:portal_url + '/' + obj_typeinfo.getIcon();"
              tal:attributes="class python:test(oddrow, 'odd', 'even')">
            <td>
              <a href="#" tal:attributes="href url">
                <img src="#" height="16" width="16"
                     tal:attributes="src icon"/>&nbsp;
                <span tal:content="obj/Title"/>
              </a>
            </td>
            <td tal:define="creator obj/Creator;
                            author python: mtool.getMemberInfo(creator);">
              <span tal:content="python: author['fullname']" />
            </td>
            <td>
              <div tal:condition="python: obj_type == 'XPointMemo'">N/A</div>
              <div tal:condition="python: obj_type == 'XPointIssue'">
                <span tal:content="obj/getXpoint_tracking_status"/>
              </div>
              <div tal:condition="python: obj_type == 'XPointProposal'">
                <span tal:content="obj/getXpoint_tracking_status"/>
              </div>
            </td>
          </tr>
        </tal:block>
      </tbody></table>
    </div>

    <div metal:use-macro="here/document_relateditems/macros/relatedItems">
      Show related items if they exist
    </div>
    <div class="visualClear" id="clear-space-after-relatedItems"></div>

  </tal:main-macro>
</metal:main>

</body>
</html>
